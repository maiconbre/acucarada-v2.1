name: Performance & Quality Check

on:
  workflow_dispatch: # Apenas execução manual
  push:
    branches: [main]
    paths:
      - 'src/**'
      - 'package.json'
      - 'package-lock.json'

jobs:
  performance-audit:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Build application
      run: npm run build
      
    - name: Analyze bundle size
      run: |
        echo "📊 Bundle Size Analysis"
        du -sh dist/
        find dist/ -name "*.js" -exec du -h {} \; | sort -hr | head -10
        echo "✅ Bundle analysis completed"
        
    - name: Check for large files
      run: |
        echo "🔍 Checking for large files (>500KB)"
        find dist/ -size +500k -type f -exec ls -lh {} \; || echo "No large files found"
        
    - name: Performance summary
      run: |
        echo "📈 Performance Summary:"
        echo "- Build completed successfully"
        echo "- Bundle size analysis completed"
        echo "- Large file check completed"
        echo "✨ Performance audit finished!"